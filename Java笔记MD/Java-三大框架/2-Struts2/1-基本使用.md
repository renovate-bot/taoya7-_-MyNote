
# Struts2

Struts是一个基于MVC设计模式的Web应用框架

### #基本使用

1. 创建web工程
2. 引入jar包
3. 创建jsp文件
```html
  <a href="hello.action">Yo！</a>
```
4. 编写Action类
```java
public class HelloAction {
    public String execute(){
        System.out.println("收到了请求");

        return "Success";//返回结果
    }
}
```
5. 创建配置文件`struts.xml`
```xml
<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE struts PUBLIC
        "-//Apache Software Foundation//DTD Struts Configuration 2.5//EN"
        "http://struts.apache.org/dtds/struts-2.5.dtd">
<struts>

    <package name="struts" extends="struts-default">
        <action name="hello" class="Unit1.HelloAction">
            <!--结果页-->
            <result name="Success">/tao.jsp</result>
        </action>
    </package>
</struts>
```
6. 前端控制器`web.xml`
```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
         version="4.0">

    <filter>
        <filter-name>action2</filter-name>
        <filter-class>org.apache.struts2.dispatcher.filter.StrutsPrepareAndExecuteFilter</filter-class>
    </filter>

    <filter-mapping>
        <filter-name>action2</filter-name>
        <url-pattern>/*</url-pattern>
    </filter-mapping>

</web-app>
```


当我们点击a标签的时候，来到`web.xml`的前端过滤器。然后`struts.xml`的`action`的name属性找到class文件。会自动调用类中`execute`方法。


### #Stuts2加载顺序

源码

- init_DefaultProperties();
- init_TraditionalXmlConfigurations();
- init_LegacyStrutsProperties();
- init_CustomConfigurationProviders();
- init_FilterInitParameters();
- init_AliasStandardObjects();

配置文件加载顺序

- default.properties
- struts-default.xml
- struts-plugin.xml
- struts.xml
- struts.properties
- web.xml

注意：后配的会把前配置的覆盖

### #配置

- `struts.xml`

**Package**

管理action的配置。

属性

- name
- extends
- namespace 命名空间
- abstract

**Action**

属性

- name
- class Action类的全路径
- method	执行Action中的那个方法名
- converter 自动义类型转换器


### #Action类

三种写法

> 一 普通类

手动实现execute方法

```
public class HelloAction {
    public String execute(){
        System.out.println("收到了请求!");

        return "Success";//返回结果
    }
}

```

> 二 实现接口`Action`

- String SUCCESS = "success";
- String NONE = "none";
- String ERROR = "errror";
- String INPUT = "input";
- String LOGIN = "login";

```java
import com.opensymphony.xwork2.Action;

public class We implements Action {
    @Override
    public String execute() throws Exception {
        System.out.println("We");
        return SUCCESS;//返回成功
    }
}
```

> 三 继承类`ActionSupport`

```java
import com.opensymphony.xwork2.ActionSupport;

public class We extends ActionSupport {
    @Override
    public String execute() throws Exception {
        System.out.println("We");
        return SUCCESS;//返回成功
    }
}
```


### #参数请求

**Demo1**

```html
<!-- method.jsp -->
<body>
<a href="add.action">添加</a>
<a href="delete.action">删除</a>
<a href="update.action">修改</a>
<a href="find.action">查看</a>
</body>
```

```xml
<!-- struts.xml -->
<include file="methods.xml"></include>

<!-- methods.xml -->
<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE struts PUBLIC
        "-//Apache Software Foundation//DTD Struts Configuration 2.5//EN"
        "http://struts.apache.org/dtds/struts-2.5.dtd">
<struts>

    <package name="method" extends="struts-default">
        <action name="add" class="Unit1.method" method="add"></action>
        <action name="delete" class="Unit1.method" method="delete"></action>
        <action name="update" class="Unit1.method" method="update"></action>
        <action name="find" class="Unit1.method" method="find"></action>
    </package>
</struts>
```

```java
/*Unit1.method*/
import com.opensymphony.xwork2.ActionSupport;

public class method extends ActionSupport {

    public String add(){
        System.out.println("添加");
        return null;
    }

    public String delete(){
        System.out.println("删除");
        return null;
    }

    public String update(){
        System.out.println("修改");
        return null;
    }

    public String find(){
        System.out.println("查找");
        return null;
    }
}

```


**通配符**

```xml
<!-- good_* 匹配 -->
<!-- {1} 代表第一个*的值-->
<package name="method" extends="struts-default">
    <action name="good_*" class="Unit1.method" method="{1}">
    	<!-- 允许通过通配符访问的方法 -->
    	<allowed-methods>add,update,delete,find</allow-methods>
    </action>
</package>
```