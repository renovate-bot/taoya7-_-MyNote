# Django模板

视图函数可以直接返回文本，若是要浏览器渲染出漂亮的HTML页面，需要模板系统，知名有DTL和Jinja2.

DTL是Django Template Language三个单词的缩写，也就是Django自带的模板语言

### DTL与HTML文件的区别

DTL模板是一种带有特殊语法的HTML文件。它可以被Django编译，可以传递参数，实现数据动态化。 在编译完成后，生成一个普通的HTML文件，然后发送客户端

### Import

- 变量

- 标签

- 过滤器

## #渲染模板

两种方式

- ##### 方式一`reader_to_string`

找到模板，然后将模板编译后的渲染Python字符串格式。最后通过HttpResponse类包装成一个HttpResponse对象返回回去。

views.py
```python
from django.shortcuts import render
from django.http import HttpResponse
from django.template.loader import render_to_string
def index(request):
    html = render_to_string('index.html')
    return HttpResponse(html)
```

- ##### 方式二 `直接将模板渲染成字符串和包装成HttpResponse对象`

views.py
```python
from django.shortcuts import render
from django.http import HttpResponse
# Create your views here.

def index(request):
    return render(request, 'index.html')
```

最后两种方式的实现结果都相同

## #模板查找路径配置

在项目的`settings.py`文件中。有一个`TEMPLATES`配置。它包含了模板引擎的配置，模板查找路径的配置，这个模板上下文配置等。

`DIRS`这是一个空列表，存放所有的模板路径。使用`render_to_string render`渲染模板 会优先在这个列表路径查找

`APP_DIRS`默认True。 会在`INSTALLED_APPS`安装的APP下的templates文件中查找模板


修改`'DIRS':[os.path.join(BASE_DIR,'templates').replace('\\','/')]`,这样就可以在APP内创建templates文件夹内放置模板文件


**如果想要在APP下创建HTML文件**

`settings.py`配置`TEMPLATES`的`'APP_DIRS': True`

`INSTALLED_APPS`添加APP文件名


## #模板变量

**变量**

模板中可以包含变量，在渲染模板的时候，可以传递变量对应的值进行替换。

变量在视图函数渲染，试图函数添加一个`context`参数，它是一个字典类型。

```python
def index(request):
    #context必须为字典形式
    context = {
        'UserName':'Tashi'
    }
    return render(request, 'index.html', context=context)
```

```html
<!--接收-->
<div>{{UserName}}</div>
```

**分类**

- 在模板中使用变量， 需要将变量放到`{{变量}}` 中

- 如果访问对象的属性，可以通过`{{对象.属性名}}`来进行访问

- 如果访问一个字典的key对应的value，通过`{{字典.key}}`的方式访问，不可以通过`[ ]`来访问
```python
def index(request):
    #context必须为字典形式
    context = {
        'UserName':{
            "age":16
        }
    }
    return render(request, 'index.html', context=context)

<div>{{UserName.age}} </div>
```


- 如果访问一个列表或者元祖 通过`{{key.value}}`来访问
```python
context = {
	'UserName':["Tashi", "Aha"]
}

<div>{{UserName.0}} </div>
```



## #常用的模板标签

所有的标签都是在`{% %}`之间

#### 1.if标签

- ##### `if...elif...else...`

- ##### `if...in...`

- ##### `闭合标签 {% endif %}`



```
from django.shortcuts import render
from django.http import HttpResponse
from django.template.loader import render_to_string
def index(request):
    #context必须为字典形式
    context = {
        "age":18
    }
    return render(request, 'index.html', context=context)


{% if age < 18 %}
    <p>未成年</p>
{% elif age == 18 %}
    <p>满18</p>
{% else %}
    <p>成年人</p>
{% endif %}
```

```
{% if XXX in XXX %}
	<P>信息</P>
```


#### 2. for...in...标签

- ##### `for...in...`
```python
def index(request):
    #context必须为字典形式
    context = {
        "book":['三国演义', '水浒传', '红楼梦', '西游记']
    }
    return render(request, 'index.html', context=context)


{% for i in book %}
   {{ i }}
{% endfor %}
```
![](image/3.png)

- ##### `for...in...`反转遍历 后加reversed
```python
{% for i in book reversed %}
   {{ i }}
{% endfor %}
```

![](image/4.png)

- ##### 遍历字典 
```python
def index(request):
    #context必须为字典形式
    context = {
        "Person":{
            "username":['小红', '小花', '小明'],
            "age":18
        }
    }
    return render(request, 'index.html', context=context)

{% for key, value in Person.items %}
    <p>Key: {{ key}}</p>
    <p>Value: {{ value }}</p>
{% endfor %}
```
![](image/5.png)


在for循环中，DTL提供了一些变量提供使用

- ##### `forloop.counter`当前循环的下标，以1起始

- ##### `forloop.counter0`以0开始

- ##### `forloop.revcunter`反向遍历

- ##### `forloop.first`是否第一次遍历

- ##### `forloop.last`是否最后一次遍历

- ##### `forloop.parentloop`如果多个循环嵌套，那么这个属性代表是上一级的for循环

#### 3. for...in...empty 标签

与for...in...不同的是，在遍历对象如果没有元素的情况下，会执行empty中的内容

```python
{% for...in... %}
pass
{% empty %}
pass
{% endfor %}
```

#### 4. With标签

```
定义变量
{% with  zs=Age  %}
    <h1>{{ zs }}</h1>
{% endwith %}
```


#### 5. URL标签

urls.py
```python
urlpatterns = [
    path('', views.index),#首页
    path('book/', views.book, name='book'),
    path('movie/', views.movie, name='movie'),
    path('city/', views.city, name='city')
]
```

views.py
```python
def index(request):
    #context必须为字典形式
    return render(request, 'index.html')

def book(request):
    return HttpResponse('读书页面')

def movie(request):
    return HttpResponse('电影页面')

def city(request):
    return HttpResponse('同城页面')
```

index.html
```html
<nav>
        <ul>
            <li><a href="/">首页</a></li>
            <li><a href="{% url 'book' %}">读书</a></li>
            <li><a href="{% url 'movie' %}">电影</a></li>
            <li><a href="{% url 'city' %}">同城</a></li>
        </ul>
    </nav>
```

![](image/6.gif)


**总结**

- ##### `<a href="{% url 'url_name' %}"> </a>`

- ##### `<a href="{% url 'url_name' 参数=值 %}"> </a>`

	```
	http://127.0.0.1:8000/book/info/1
	```

- ##### `<a href="{% url 'url_name' %}?参数=值 参数=值"> </a>`

	```
	http://127.0.0.1:8000/login/?user="Tashi"&pwd="123456"
	```