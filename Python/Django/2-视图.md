# 视图与URL

### 视图函数

视图一般写在`app`的views.py中。这个对象存储了请求过来的所有信息，包括携带的参数以及一些头部信息。

**注意**

1. 试图函数的第一个参数必须是request，参数必不可少

2. 返回值必须是`diango http.response.HttpResponseBase`的子类的对象

创建视图
```
python manage.py startapp book
```

在book/view.py
```python
from django.shortcuts import render
from django.http import HttpResponse
# Create your views here.

def book(request):
    return HttpResponse("图书")
```

在Demo/urls.py添加映射
```python
from django.contrib import admin
from django.urls import path
from book import views
urlpatterns = [
    path('admin/', admin.site.urls),
    path('book/',views.book)
]
```

打开浏览器 就可以看到‘图书’
```
http://127.0.0.1:8000/book/
```

### URL添加参数

1. 采用URL使用变量的方式。在path的第一个参数中，使用`<参数名>`的方式传递参数，然后在视图函数中也要写一个参数， 视图函数中的参数必须和URL中的参数名称保持一致，不然就找不到这个参数。同时支持传递多个参数

2. 采用查询字符串的方式。在URL中不需要单独的匹配字符串的部分。只需要在视图函数中使用`request.GET.get("参数名称")`的方式来获取。在访问的网站的时候前加上`?`+`参数名称=值`

**方式一**

book/views.py
```python
from django.shortcuts import render
from django.http import HttpResponse
# Create your views here.

def index(request):
    return HttpResponse("首页")

def book(request):
    return HttpResponse("The Book")

def book_info(request, book_id, book_kind):
    #从数据库中提取信息
    text = "获取ID为<%s>  图书种类是<%s>"%(book_id, book_kind)
    return HttpResponse(text)
```

demo/urls.py

- `< >`包含参数

```python
from django.contrib import admin
from django.urls import path
from book import views



urlpatterns = [
    path('', views.index), #首页
    path('admin/', admin.site.urls),
    path('book/',views.book),
    path('book/index/<book_id>/<book_kind>', views.book_info)

]
```

打开网站 参数要一致

![](image/1.png)

**方式二**

views.py
```python
def author_info(request):
    author_name = request.GET.get('name')
    text = "作者姓名是 %s"%author_name
    return HttpResponse(text)
```

urls.py
```python
urlpatterns = [
    path('book/author/',views.author_info)
]
```

打开网站

![](image/2.png)


**Demo**

> 如果没有传入Username参数那么就跳转登陆页面

```python
from diango.shortcuts import redirect #重定向

#首页
def index(request):
	username = request.GET.get('username')
	if username:
		return HttpResponse('前台首页')
	else:
		return redirect('/login/')

#登陆
def login(request):
	return HttpResponse('前台登陆页面')
```

### 总结

**为什么需要URL命名**

因为URL是经常变化的。如果在代码中写死可能会经常修改代码。给URL起个名字，以后使用URL时候就使用它的名字进行反转就可以了。

**如何给一个URL指定名称**

在`path`中，传递一个`name`参数

```python
urlpatterns = [
    path('index',views.index, name='index')
]
```

**APP命名**

多个APP之间 可能产生同名的URL。为了避免

变量应该命名 AppName.参数


