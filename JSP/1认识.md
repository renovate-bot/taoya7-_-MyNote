# JSP  `java Server Pages`

**是什么**

JSP全称Java Server Pages，是一种动态网页开发技术。它使用JSP标签在HTML网页中插入Java代码。

其根本是一个简化的Servlet设计

**为什么**

JSP页面可以与处理业务逻辑的 Servlet 一起使用

**工作原理**

本质就是一个Servlet。第一次被访问会被Web容器翻译成Servlet，`index.jsp` -> `index.jsp.java` -> `index.jsp.class`.下一次访问的时候先看页面有没有变化，如果变化了重新翻译。


**基本模板**
```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" pageEncoding="UTF-8" %>

<html>
  <head>
    <title>JSP-Demo</title>
  </head>
  <body>

  </body>
</html>
```

### #语法


**变量**

- `<%java代码 %>`代码会被翻译导service方法内部
- `<%=变量或表达式>`代码会service方法内部print()
- `<%!java代码>`代码会成为servlet成员变量

```java
public final class index_jsp ... {
 	//<%!java代码> 声明的变量

 	public void _jspService(...){
 		//<%java代码 %> 声明的变量

 		out.print(1+1); //<%=1+1>
 	}

}
```

**注释**

- `<!--  -->`html注释
- `// 或者 /* */`  ~~可见范围：~~ jsp源码、翻译后的servlet源码，页面看不到
- `<%-- --%>`jsp注释 ~~可见范围：~~ 仅在jsp源码可见

### #JSP指令

设置页面的相关信息，用于与其他jsp文件的通信

- `page指令`设置页面的属性和相关信息
	- contentType="text/html;charset=UTF-8"  编码格式
	- pageEncoding文件编码
	- import引入Java的包和类
	- session
	- errorPage发生错误会跳转
	- isErrorPage
	- language
	- extends
	- buffer设置缓冲区
	- autoFlush
	- isThreadSafe
	- info
	- isELIgnored
- `include指令`插入包含文件
- `taglib指令`声明使用了那些标签库
	- JSP标签库
	- 第三方标签库
	- 自定义标签库

```jsp
<!-- include插入一个包含文件或者代码的文件 -->
<%@
	include file="/book.jsp"
%>
```

```jsp
<!-- page页面相关的信息 -->
<%@page ...%>
```

> JSP标签库

- 页面包含
- 请求转发


```jsp
// 静态包含
/*
	将两个jsp页面拼接在一起，然后翻译servlet
*/
<%@
	include file="/header.jsp"
%>
<%@
	include file="/footer.jsp"
%>

// 动态包含
/*
	各自翻译自己的页面 然后引入
*/
<jsp:include page='/header.jsp'></jsp:include>
```

```jsp
//页面转发

<jsp:forward page="404.jsp"></jsp:forward>
```

### #隐式对象

jsp翻译成servlet之后，有9个对象定义并且初始化完毕，可以直接使用这些对象

- out 向客户端输出内容

out对象通过调用pageContext对象的getOut()进行返回。
	
out对象的类型JspWriter，这是一个带有缓存功能的PrintWriter。默认8Kb,如果设置为0代表关闭out缓冲区直接写道response缓冲区。

- request 请求对象
- response 响应对象
- config 服务器配置，可以获取初始化参数
- session 会话信息
- application 共享信息servletContext
- page 转换servlet类的实例

page对象表示当前一个JSP页面，可以理解为一个对象本身

- pageContext
- exception 异常页面会有该对象

```jsp
<!-- PageContext -->
<%pageContext.setAttribute("Name", "Tashi",PageContext.REQUEST_SCOPE);%>

<%=pageContext.getAttribute("Name",PageContext.REQUEST_SCOPE)%>
```

```jsp
<!-- PageContext对象 -->
- 获得其他对象
getException
getPage()
getRequest()
getResponse()
getServletConfig()
getServletContext()
getSession
getOut()
	
- 作为域对象
setAttribute()
getAttribute()
removeAttribute()
findAttribute()
```

### #JSP标签

JSP标签也称之为Jsp Action(JSP动作)元素，它用于在Jsp页面中提供业务逻辑功能，避免在JSP页面中直接编写java代码，造成jsp页面难以维护

**JSP常用标签**

`<jsp:include>` `<jsp:forward>` `<jsp:param>`

- **include**

用于把另外一个资源的输出内容插入进当前JSP页面的输出内容之中，这种在JSP页面执行时的引入方式称之为动态引入

> 与include指令的区别

一个是静态引入，一个是动态引入

- **forward**

用于把请求转发给另外一个资源

```jsp
<jsp:forward page="/book.jsp"/>
```

- **param**

向这个资源传递参数

```jsp
<jsp:include page="/book.jsp">
    <jsp:param name="name" value="tashi" />
</jsp:include>

<h2><%=request.getParameter("name")%></h2>
```

```
<!-- index.jsp -->
<jsp:forward page="/forwarddemo04.jsp">
	<jsp:param name="ref1" value="hello" />
	<jsp:param name="ref2" value="gacl" />
</jsp:forward>

<!-- forwarddemo04.jsp -->
<h1>ref1：<%=request.getParameter("ref1")%></h1>
<h1>ref2：<%=request.getParameter("ref2")%></h1>
```

